# -*- mode: Makefile -*-
# $OpenXM: OpenXM/src/ox_toolkit/Makefile.in,v 1.2 2000/02/08 20:33:06 ohara Exp $

OpenXM_HOME = ../..
GMPSRC      = ${OpenXM_HOME}/src/gmp
OXWEAVE     = ${OpenXM_HOME}/bin/oxweave
CC          = @CC@
CFLAGS      = -g -O2 -DDEBUG -I${GMPSRC}
OBJS        = ox.o parse.o mysocket.o
BINARIES    = bconv testclient sample1 sample2 
DOCUMENTS   = readme-eg readme-jp bnf-eg bnf-jp
X11INC      = @X_CFLAGS@
X11LIB      = @X_LIBS@ @X_PRE_LIBS@ -lX11 @X_EXTRA_LIBS@
RANLIB      = @RANLIB@
LIBS        = @LIBS@ -L. -lox -lgmp
INSTALL_DATA= cp -f 
LN          = @LN_S@

all: libox.a libgmp.a ${BINARIES} ${DOCUMENTS}

all2: all ox_Xsample

ox.o mysocket.o: mysocket.h
ox.o parse.o:    ox.h oxtag.h parse.h

libgmp.a:
	test -f ${GMPSRC}/libgmp.a || (cd ${GMPSRC}; ./configure; ${MAKE})
	-${LN} ${GMPSRC}/libgmp.a .

libox.a: ${OBJS}
	-rm -f $@
	ar -rc $@ ${OBJS}
	${RANLIB} $@

bconv: bconv.o libox.a libgmp.a
	${CC} ${CFLAGS} -o $@ bconv.o ${LIBS}

testclient: testclient.o libox.a libgmp.a
	${CC} ${CFLAGS} -o $@ testclient.o ${LIBS}

sample1: sample1.o libox.a libgmp.a
	${CC} ${CFLAGS} -o $@ sample1.o ${LIBS}

sample2: sample2.o libox.a libgmp.a
	${CC} ${CFLAGS} -o $@ sample2.o ${LIBS}

ox_Xsample: ox_Xsample.o glib.c libox.a libgmp.a
	${CC} ${CFLAGS} ${X11INC} -o $@ ox_Xsample.o glib.c ${LIBS} ${X11LIB} 

readme-jp: README
	${OXWEAVE} ja common < README > readme-jp

readme-eg: README
	${OXWEAVE} en common < README > readme-eg

bnf-jp: bnf.oxweave
	${OXWEAVE} ja common < bnf.oxweave > bnf-jp

bnf-eg: bnf.oxweave
	${OXWEAVE} en common < bnf.oxweave > bnf-eg

install: install-document install-binary

install-binary: libox.a ox.h
	-if [ ! -d ${OpenXM_HOME}/include/ox ]; then \
		mkdir -p ${OpenXM_HOME}/include/ox ;\
	fi
	cp -f libox.a ${OpenXM_HOME}/lib
	cp -f ox.h ${OpenXM_HOME}/include/ox

install-for-debug:
	@echo "No binaries are installed."

install-document: ${DOCUMENTS}
	-mkdir ${OpenXM_HOME}/doc/ox_toolkit
	${INSTALL_DATA} ${DOCUMENTS} ${OpenXM_HOME}/doc/ox_toolkit

clean-document:
	-rm -f ${DOCUMENTS}

clean-binary:
	-rm -f *.o *~ libox.a libgmp.a ${BINARIES} ox_Xsample core a.out

clean: clean-document clean-binary
