# -*- mode: Makefile -*-
# $OpenXM: OpenXM/src/ox_toolkit/Makefile.in,v 1.7 2000/03/08 06:41:54 ohara Exp $

OpenXM_HOME = ../..
OXWEAVE     = ${OpenXM_HOME}/bin/oxweave
CC          = @CC@
CFLAGS      = -g -O2 -DDEBUG -I${OpenXM_HOME}/include
OBJS        = ox.o parse.o mysocket.o
BINARIES    = bconv testclient sample1 sample2 
DOCUMENTS   = readme-eg readme-jp bnf-eg bnf-jp
X11INC      = @X_CFLAGS@
X11LIB      = @X_LIBS@ @X_PRE_LIBS@ -lX11 @X_EXTRA_LIBS@
RANLIB      = @RANLIB@
LIBS        = @LIBS@ -L${OpenXM_HOME}/lib -L. -lox -lgmp
INSTALL_DATA= cp -f 
OXOBJS      = ox.o parse.o bconv.o testclinet.o ox_Xsample.o \
              sample1.o sample2.o

all: libox.a ${BINARIES} ${DOCUMENTS}

all2: all ox_Xsample

ox.o mysocket.o: mysocket.h
ox.o parse.o:    parse.h
${OXOBJS}:       ox_toolkit.h ox_toolkit_tags.h

libox.a: ${OBJS}
	-rm -f $@
	ar -rc $@ ${OBJS}
	${RANLIB} $@

bconv: bconv.o libox.a
	${CC} ${CFLAGS} -o $@ bconv.o ${LIBS}

testclient: testclient.o libox.a
	${CC} ${CFLAGS} -o $@ testclient.o ${LIBS}

sample1: sample1.o libox.a
	${CC} ${CFLAGS} -o $@ sample1.o ${LIBS}

sample2: sample2.o libox.a
	${CC} ${CFLAGS} -o $@ sample2.o ${LIBS}

ox_Xsample: ox_Xsample.o glib.c libox.a
	${CC} ${CFLAGS} ${X11INC} -o $@ ox_Xsample.o glib.c ${LIBS} ${X11LIB} 

readme-jp: README
	${OXWEAVE} ja common < README > readme-jp

readme-eg: README
	${OXWEAVE} en common < README > readme-eg

bnf-jp: bnf.oxweave
	${OXWEAVE} ja common < bnf.oxweave > bnf-jp

bnf-eg: bnf.oxweave
	${OXWEAVE} en common < bnf.oxweave > bnf-eg

install: install-document install-binary

install-binary: libox.a ox_toolkit.h ox_toolkit_tags.h
	-if [ ! -d ${OpenXM_HOME}/lib ]; then \
		mkdir -p ${OpenXM_HOME}/lib ;\
	fi
	-if [ ! -d ${OpenXM_HOME}/include ]; then \
		mkdir -p ${OpenXM_HOME}/include ;\
	fi
	${INSTALL_DATA} libox.a ${OpenXM_HOME}/lib
	${INSTALL_DATA} ox_toolkit.h ox_toolkit_tags.h ${OpenXM_HOME}/include

install-for-debug:
	@echo "No binaries are installed."

install-document: ${DOCUMENTS}
	-mkdir ${OpenXM_HOME}/doc/ox_toolkit
	${INSTALL_DATA} ${DOCUMENTS} ${OpenXM_HOME}/doc/ox_toolkit

clean-document:
	-rm -f ${DOCUMENTS}

clean-binary:
	-rm -f *.o *~ libox.a ${BINARIES} ox_Xsample core a.out

clean: clean-document clean-binary

distclean: clean
	-rm -f .configure_done configure config.cache config.log config.status Makefile

