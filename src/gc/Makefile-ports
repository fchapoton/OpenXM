# $OpenXM: OpenXM/src/gc/Makefile-ports,v 1.1 2003/11/10 11:42:59 takayama Exp $
OpenXM_HOME=../..
PREFIX=${OpenXM_HOME}
DISTDIR=${OpenXM_HOME}/../OpenXM_dist
RM = /bin/rm -rf
MASTER_CITES=ftp.math.kobe-u.ac.jp
# MASTER_CITES2 = 
DISTFILES=gc6.2.tar.gz

all : build 
install : post-install

pre-fetch:
	-@if test ! -f .pre-fetch_done ; \
	then \
	  mkdir ${DISTDIR} ; \
	fi 
	@touch .pre-fetch_done


fetch: pre-fetch
	@if test ! -f .fetch_done ; \
	then \
	  (cd ${DISTDIR}; wget --passive-ftp ftp://$(MASTER_CITES)/pub/OpenXM/misc/$(DISTFILES)) ; \
	fi 
	@touch .fetch_done

patch : fetch
	@if test ! -f .patch_done ; \
	then \
	  $(RM) work ; \
	  mkdir work ; \
	  (cd work ; tar xzvf ../${DISTDIR}/${DISTFILES} ) ; \
	fi 
	@touch .patch_done
#	  (cd work; patch -c -p0 <../patch-aa ; patch -c -p0 <../patch-bb ; patch -c -p0 <../patch-cc) ; \

build : patch
	@if test ! -f .build_done ; \
	then \
		(cd work/gc6.2 ; ./configure --prefix `pwd`/../../../../../OpenXM ; make ) ; \
	fi
	@touch .build_done

post-install: build
	@if test ! -f .post-install_done ; \
	then \
		-mkdir ${PREFIX}/lib ${PREFIX}/bin ; \
		(cd work/gc6.2 ; make install) ; \
	fi
	@touch .post-install_done

clean:
	$(RM)  .*_done
	-(cd work/gc6.2 ; make clean)
distclean:
	$(RM)  .*_done ./.use_ports
	-(cd work/gc6.2 ; make distclean)
