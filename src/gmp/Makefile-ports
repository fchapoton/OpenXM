# $OpenXM: OpenXM/src/gmp/Makefile-ports,v 1.3 2004/02/23 00:32:56 takayama Exp $
OpenXM_HOME=../..
PREFIX=${OpenXM_HOME}
DISTDIR=${OpenXM_HOME}/../OpenXM_dist
RM = /bin/rm -rf
MASTER_CITES=ftp.math.kobe-u.ac.jp
# MASTER_CITES2 = 
DISTFILES=gmp-3.1.1.tar.gz
GMP=gmp-3.1.1
#DISTFILES=gmp-4.1.2.tar.gz
#GMP=gmp-4.1.2

all : build 
install : post-install

fetch:
	@if test ! -f .fetch_done ; \
	then \
		${OpenXM_HOME}/bin/oxfetch.sh ftp://${MASTER_CITES}/pub/OpenXM/misc/${DISTFILES} ${DISTDIR}; \
	fi 
	@touch .fetch_done

patch : fetch
	@if test ! -f .patch_done ; \
	then \
	  $(RM) work ; \
	  mkdir work ; \
	  (cd work ; tar xzvf ../${DISTDIR}/${DISTFILES} ) ; \
	fi 
	@touch .patch_done
#	  (cd work; patch -c -p0 <../patch-aa ; patch -c -p0 <../patch-bb ; patch -c -p0 <../patch-cc) ; \

build : patch
	@if test ! -f .build_done ; \
	then \
		(cd work/${GMP} ; ./configure --prefix `pwd`/../../../../../OpenXM ; make ) ; \
	fi
	@touch .build_done

post-install: build
	@if test ! -f .post-install_done ; \
	then \
		if [ ! -d ${PREFIX}/lib ]; then mkdir ${PREFIX}/lib ; fi ; \
		if [ ! -d ${PREFIX}/bin ]; then mkdir ${PREFIX}/bin ; fi ; \
		(cd work/${GMP} ; make install) ; \
		(cd work/${GMP} ; cp gmp-impl.h config.h gmp-mparam.h ../../${OpenXM_HOME}/include) ; \
	fi
	@touch .post-install_done

clean:
	$(RM)  .*_done
	-(cd work/${GMP} ; make clean)
distclean:
	$(RM)  .*_done ./.use_ports
	-(cd work/${GMP} ; make distclean)
