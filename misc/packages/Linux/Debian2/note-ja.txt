Todo: Makefile-fix,  cf. misc-2005/A2/knoppix-2006/Makefile-asir,  .TeXmacs 関連.
 
Q. パッケージを新しくしたい.
A. 
   1. すべての作業は 
       source dot.bashrc 
      をしてから. (一部高山用)
   2. debian/changelog を修正.  date は rfc822 format を守る事.
        ( dpkg-parsechangelog  で check.
          署名するには, mail address を pgp のものと同一に.)
   3. Makefile の VERSION を変更. コメントにある他のファイルの VERSION も変更.
   4. make clean
   5. make
   6. make copy-tar-ball-and-asir
   (7. orange2 で /root/bin/mirror.ftp)

Q. 各ステップでは何をやっていますか? 注意事項は?
A. 
   1. source dot.bashrc 
   2. debian/changelog を修正.  date は rfc822 format を守る事.
   3. Makefile の VERSION を変更. コメントにある他のファイルの VERSION も変更.
         VERSION は OpenXM/download/version.txt としてコピーされる.
         文末の空白等加えないように.
         version は ダウンロードするファイル名に反映される.
   4. make clean
   5. make
        fetch : work/OpenXM, work/OpenXM_contrib2
        build: work/OpenXM で標準的な OpenXM を make install
        build-knoppix: OpenXM/bin/asir が /home/knoppix/.asir-tmp/asir への symbolic link に.
                    OpenXM/lib/asir/FLL のライブラリも.
                    asir-port.sh, asir-install.sh をインストール.
                    tar を作成. md5 を work/OpenXM/lib/asir へ.
        make-tar-ball-2: 
            work/OpenXM を tar ball に.
            tar する directory は Makefile をみよ.
            exclude-files.txt に除くファイルが.
            md5 を OpenXM/download へ.
        build: deb を生成.
            このプロセスは, OpenXM/download/*.md5 が与えれていれば他とは独立. 
   6. make copy-tar-ball-and-asir

            openxm*.deb,
            openxm-binary*.tar.gz  (本体)
            asir*
     を ftp サーバへコピーする.

   (7. orange2 で /root/bin/mirror.ftp)
 

Q. openxm-binary*.tar.gz をインストールする仕組みは?
A. OpenXM/download/openxm-install.sh (OpenXM/bin/opennxm-install.sh)
   が oxfetch.sh で openxm-binary*.tar.gz  をネットワークインストールします.
   $HOME/OpenXM_tmp (/root/OpenXM_tmp ) に openxm-binary*tar.gz が一時おかれます.
   このスクリプトは,  Debian/openxm.postinst より起動されています.

Q. OpenXM 部分の修正のみがあります.
A. 
   rm -f .fetch_done
   work/OpenXM 以下を修正.  (必要があれば kerberos へ commit)
   make
   make copy-tar-ball-and-asir
   
   md5 を無視する場合は openxm*deb の修正は不要.

   openxm*deb は oxfetch.sh, openxm-install.sh (と  OpenXM/download/*md5 )
  の修正の時のみ修正.

Q. openxm*deb のみ修正したい.
A. make build-deb


Q. パッケージのテスト.  
  (開発者の環境では iyokan-6. source dot.bashrc してから export OpenXM_HOME= )
A. 
  インストール.
   ln -s 書き込める場所  /home/knoppix/.asir-tmp
   rm -rf /home/knoppix/.asir-tmp/*
   sudo dpkg --install openxm*.deb

  実行.
   openxm asir-port.sh

  削除.
   sudo dpkg --remove openxm


 なお package のインストールで始めの質問に no と答えた場合,
 openxm-binary*.tar.gz がインストールされません. 
 インストールするには,
    sudo update-menus
    sudo OpenXM_HOME=/usr/local/OpenXM /usr/local/OpenXM/download/openxm-install.sh
    sudo OpenXM_HOME=/usr/local/OpenXM ; /usr/local/bin/openxm asir-install.sh

Q. kde の menu を /usr/lib/menu/openxm-binary から /usr/lib/menu/openxm に変更したい.
A. 
   work/OpenXM 以下にはすでに package build をしたコンパイル済みのソースが展開されていると仮定.

  OpenXM/rc/kde/openxm-binary-knoppix を debian/rules の install ターゲットで deb パッケージに
  コピーしている.
  work/OpenXM/rc/kde/openxm-knoppix を加えて. cvs でadd.

 (1) debian/changelog, Makefile, OpenXM/deoanload/Makefile work/OpenXM/src/asir-port/Makefile
     の minior version を上げる.
 (2) debian/rules で openxm を /usr/lib/menu へコピーするように設定変更.
 (3) Binary file やインストールされるライブラリには変更ないので, Full build は必要ない.
     Knoppix 独自の変更なので, 

     rm .build-knoppix_done .make-tar-ball*done

     make  で OK.

 (4) make copy-tar-ball-and-asir   (orange2 で /root/bin/mirror.ftp)

 あとはテスト. うまくいかないときは, 修正のあと (3) にもどって繰り返す.

 (5) この directory で commit
     cd work/OpenXM で必要なものを commit.  

 (*) OpenXM/download/version.txt は work/OpenXM/src/asir-port の Makefile で生成される.

Q. deb file に入ってるものをとりだしたい.
A. 
   dpkg-deb --extract xxxyyy.deb  tmp-any
   dpkg-deb --control xxxyyy.deb

Q. rm -f .build* .make* ; make で asir を work/OpenXM/bin へコピーするところで,
  エラーをおこします. [2006-02-11]
A. work/OpenXM/bin/asir が /home/knoppix/.asir-tmp へのリンクとなってるのが原因で
   しょう.
   まず
   (cd work/OpenXM/asir/asir-port ; make uninstall-for-knoppix)
   をして下さい.

Q.  work/OpenXM/src/asir-contrib/packages/doc を更新しました.
A.  まず rm work/OpenXM/asir/asir-contrib/packages/doc/.*done してから make して下さい.


Q. work/OpenXM/src/asir-doc/extract_func.c が更新された.
   work/OpenXM_contrib2/asir2000/ が更新された.
A. rm .build*done .make*done
   (cd work/OpenXM/src/asir2000 ; rm .make*done .install*done)
   (cd work/OpenXM/src/asir-contrib/packages/doc ; rm .install*done)
   make 
   make copy-tar-ball-and-asir
  # テストは以下のようにしてもできる.
  #(cd work/OpenXM/src/asir-port ; make uninstall-for-knoppix)
  #(cd work/OpenXM/rc ; make ; source dot.bashrc ; openxm asir など)

Q. openxm asir-port.sh  --> ファイルがないといわれます.
A. /usr/local/bin/openxm が正しく生成されていないからであろう.
  (cd work/OpenXM/rc ; make clean) してから, tar ball を生成.
  [ Makefile もそのように更新した. 
    rm .make*tar*done  ; make ; make copy-tar-ball-and-asir ]

Q. asir のソースコードに変更があった.
A. rm -f work/OpenXM/src/asir2000/.make_done
   (cd work; rcvs update OpenXM_contrib2/asir2000)
   rm -f .build*done  .make-tar*
   make
   make copy-tar-ball-and-asir


$OpenXM: OpenXM/misc/packages/Linux/Debian2/note-ja.txt,v 1.6 2006/02/12 12:25:42 takayama Exp $

   


 