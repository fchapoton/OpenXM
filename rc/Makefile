# $OpenXM: OpenXM/rc/Makefile,v 1.20 2004/02/26 09:54:27 takayama Exp $
# make repl
# make all
# make install  [ PREFIX=/home/hoge ]  ; Default is /usr/local
CC=gcc
# SHELL_SCRIPTS=asir sm1 oxgp k0 oxmath oxMathematica ox
SHELL_SCRIPTS=asir sm1 oxmath oxMathematica ox openxm webasir
PREFIX=/usr/local
INSTALL_DIR=${PREFIX}/bin
MAN_DIR=../man/man1
KDE_MENU_DIR=/usr/lib/menu

all :  dot.bashrc  dot.cshrc  openxm  .done_gen-shell-scripts

dot.bashrc : bashrc repl 
	rm -f dot.bashrc 
	echo "# DO NOT EDIT THIS FILE" >dot.bashrc
	./repl bash <bashrc >>dot.bashrc

dot.cshrc : cshrc repl
	rm -f dot.cshrc 
	echo "# DO NOT EDIT THIS FILE" >dot.cshrc
	./repl csh <cshrc >>dot.cshrc

repl : repl.c 
	rm -f repl
	${CC} -static -o ../bin/rc.repl repl.c
	ln -s ../bin/rc.repl repl

openxm : dot.bashrc
	rm -f openxm
	echo "#!/bin/sh" >openxm
	cat dot.bashrc >>openxm
	echo 'exec $$*' >>openxm
	chmod +x openxm
	cp -f openxm ../bin

.done_gen-shell-scripts : dot.cshrc Makefile gen-shell-scripts
	./gen-shell-scripts
	touch .done_gen-shell-scripts

install : install-usr-bin install-kde-menu
install-usr-bin: all
	-cp -f $(SHELL_SCRIPTS) ${INSTALL_DIR}
install-kde-menu-knoppix:
	install kde/openxm-binary-knoppix ${KDE_MENU_DIR}/openxm-binary
install.man :
	-cp openxm.1 ${MAN_DIR}

install.asir_key:
	-../bin/sm1 -f fetch_asir_key.sm1

install-bin :
	cp -f webasir ../bin

clean :
	rm -rf dot.bashrc dot.cshrc repl openxm $(SHELL_SCRIPTS) .done_gen-shell-scripts work

